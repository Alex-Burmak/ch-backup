[tox]
envlist    = isort, yapf, flake8, pylint, mypy, bandit, py35_unit_test, py35_integration_test
skipsdist  = True
minversion = 3

[testenv]
basepython = !yapf: python3.5
             yapf:  python3.6
envdir     = !yapf: {toxworkdir}/py35
             yapf:  {toxworkdir}/py36
setenv     = PYTHONIOENCODING = {env:PYTHONIOENCODING:utf8}
deps       = -rrequirements-test.txt

[testenv:isort]
commands = isort --recursive --check-only --ignore-whitespace --diff ch_backup tests

[testenv:yapf]
commands = yapf -rpd ch_backup tests

[testenv:flake8]
; ignoring the checks:
;   E122 (continuation line missing indentation or outdented),
;   E126 (continuation line over-indented for hanging indent),
;   E131 (continuation line unaligned for hanging indent) as indentation is responsibility of yapf
;   F401 (module imported but unused) in favor of corresponding pylint check
commands = flake8 --select=E,F,W,C,S --ignore=E122,E126,E131,F401 ch_backup tests

[testenv:pylint]
commands = pylint --reports=no --score=no ch_backup
           pylint --disable=redefined-outer-name,missing-docstring,invalid-name --reports=no --score=no tests/unit
           pylint --reports=no --score=no tests/integration

[testenv:mypy]
commands = mypy ch_backup tests

[testenv:bandit]
; ignoring the checks:
;   B101:assert_used
commands = bandit -r -s B101 ch_backup

[testenv:py35_unit_test]
commands = py.test tests/unit

[testenv:py35_integration_test]
passenv  = CLICKHOUSE_VERSION
commands = behave --show-timings --stop {env:BEHAVE_OPTS:} @tests/integration/ch_backup.featureset

[testenv:requirements]
envdir   = {toxworkdir}/requirements
deps     = -rrequirements.in.txt

[testenv:test_requirements]
envdir   = {toxworkdir}/test_requirements
deps     = -rrequirements.txt
           -rrequirements-test.in.txt
